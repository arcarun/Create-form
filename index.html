<!DOCTYPE html>
<html>
<head>
    <title>A R Computers - Task Entry Form</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Task Entry Form</h2>
    
    <form id="taskForm">
        <div class="form-group">
            <label>Author</label>
            <select id="author" required>
                <option value="Simran">Simran</option>
                <option value="Zaid">Zaid</option>
                <option value="Farheen">Farheen</option>
                <option value="Irfan">Irfan</option>
            </select>
        </div>

        <div class="form-group">
            <label>Company Name</label>
            <input type="text" id="company" list="clientList" oninput="searchCompany(this.value)" autocomplete="off" required>
            <datalist id="clientList"></datalist>
        </div>

        <div class="form-group">
            <label>User Name</label>
            <input type="text" id="user" required>
        </div>

        <div class="form-group">
            <label>Mobile Number</label>
            <input type="text" id="mobile" required>
        </div>

        <div class="form-group">
            <label>Location</label>
            <input type="text" id="location" required>
        </div>

        <div class="form-group">
            <label>Bill Amount</label>
            <input type="number" id="bill" required>
        </div>

        <div class="form-group">
            <label>Type</label>
            <select id="type" required>
                <option value="Call Basic">Call Basic</option>
                <option value="Rentals">Rentals</option>
                <option value="Vendor">Vendor</option>
            </select>
        </div>

        <div class="form-group">
            <label>Problem Description</label>
            <textarea id="problem" rows="4" required></textarea>
        </div>

        <button type="submit" id="submitBtn">Submit Task</button>
    </form>

    <script>
        // REPLACE THESE TWO URLS WITH YOUR ACTUAL WEB APP URLS
        const SHEET1_SUBMIT_URL = 'INSERT_YOUR_SHEET_1_WEB_APP_URL_HERE'; 
        const SHEET2_DATABASE_URL = 'INSERT_YOUR_SHEET_2_WEB_APP_URL_HERE'; 

        let fetchedClients = [];

        function searchCompany(query) {
            // If the user selects a company from the list, autofill immediately
            const match = fetchedClients.find(c => c.company === query);
            if (match) {
                document.getElementById('user').value = match.user;
                document.getElementById('mobile').value = match.mobile;
                document.getElementById('location').value = match.location;
                return;
            }

            // Do not send request if input is empty
            if (query.trim() === "") {
                document.getElementById('clientList').innerHTML = "";
                return;
            }

            // Fetch matched data from Sheet 2 in real-time
            fetch(SHEET2_DATABASE_URL + "?searchQuery=" + encodeURIComponent(query))
                .then(response => response.json())
                .then(data => {
                    fetchedClients = data;
                    const list = document.getElementById('clientList');
                    list.innerHTML = ""; 
                    
                    data.forEach(client => {
                        let option = document.createElement('option');
                        option.value = client.company;
                        list.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching database:', error));
        }

        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerText = 'Processing...';

            const formData = {
                author: document.getElementById('author').value,
                company: document.getElementById('company').value,
                user: document.getElementById('user').value,
                mobile: document.getElementById('mobile').value,
                location: document.getElementById('location').value,
                bill: document.getElementById('bill').value,
                type: document.getElementById('type').value,
                problem: document.getElementById('problem').value
            };

            fetch(SHEET1_SUBMIT_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                body: JSON.stringify(formData)
            })
            .then(response => response.text())
            .then(result => {
                alert('Task Submitted Successfully!');
                document.getElementById('taskForm').reset();
                submitBtn.innerText = 'Submit Task';
            })
            .catch(error => {
                alert('Error submitting task.');
                submitBtn.innerText = 'Submit Task';
            });
        });
    </script>
</body>
</html>