<!DOCTYPE html>
<html>
<head>
    <title>A R Computers - Task Entry Form</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        #message { margin-top: 15px; padding: 10px; display: none; }
    </style>
</head>
<body>

    <h2>Task Entry Form</h2>
    
    <form id="taskForm">
        <div class="form-group">
            <label>Author</label>
            <select id="author" required>
                <option value="Simran">Simran</option>
                <option value="Zaid">Zaid</option>
                <option value="Farheen">Farheen</option>
                <option value="Irfan">Irfan</option>
            </select>
        </div>

        <div class="form-group">
            <label>Company Name</label>
            <input type="text" id="company" list="clientList" oninput="autoFillData(this.value)" autocomplete="off" required>
            <datalist id="clientList"></datalist>
        </div>

        <div class="form-group">
            <label>User Name</label>
            <input type="text" id="user" required>
        </div>

        <div class="form-group">
            <label>Mobile Number</label>
            <input type="text" id="mobile" required>
        </div>

        <div class="form-group">
            <label>Location</label>
            <input type="text" id="location" required>
        </div>

        <div class="form-group">
            <label>Bill Amount</label>
            <input type="number" id="bill" required>
        </div>

        <div class="form-group">
            <label>Type</label>
            <select id="type" required>
                <option value="Call Basic">Call Basic</option>
                <option value="Rentals">Rentals</option>
                <option value="Vendor">Vendor</option>
            </select>
        </div>

        <div class="form-group">
            <label>Problem Description</label>
            <textarea id="problem" rows="4" required></textarea>
        </div>

        <button type="submit">Submit Task</button>
    </form>

    <div id="message"></div>

    <script>
        // URLs for the two different sheets
        const SHEET1_SUBMIT_URL = 'https://script.google.com/macros/s/AKfycbxqzK-DGjwf6nMT_wNGgQhQWO1h1exYHhJPixOAldRvYh3QppH059B5VPHTJssJo9Xh/exec'; 
        const SHEET2_DATABASE_URL = 'https://script.google.com/macros/s/AKfycbzOfFw8TFevVsed2p0NCzlafvfwidLksSj1frmb9G8GOY2SKDwrluHT_f7og52NJxosw/exec'; 

        let globalClientData = [];

        // 1. Fetch data from Sheet 2 (Customer database) on load
        window.onload = function() {
            fetch(SHEET2_DATABASE_URL)
                .then(response => response.json())
                .then(data => {
                    globalClientData = data;
                    const list = document.getElementById('clientList');
                    list.innerHTML = ""; 
                    data.forEach(client => {
                        let option = document.createElement('option');
                        option.value = client.company;
                        list.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching database:', error));
        };

        // 2. Autofill fields when a company is selected
        function autoFillData(val) {
            const client = globalClientData.find(c => c.company === val);
            if (client) {
                document.getElementById('user').value = client.user;
                document.getElementById('mobile').value = client.mobile;
                document.getElementById('location').value = client.location;
            }
        }

        // 3. Submit form data to Sheet 1 (Task Form)
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const msgDiv = document.getElementById('message');
            msgDiv.style.display = 'block';
            msgDiv.style.backgroundColor = '#f0f0f0';
            msgDiv.textContent = 'Processing...';

            const formData = {
                author: document.getElementById('author').value,
                company: document.getElementById('company').value,
                user: document.getElementById('user').value,
                mobile: document.getElementById('mobile').value,
                location: document.getElementById('location').value,
                bill: document.getElementById('bill').value,
                type: document.getElementById('type').value,
                problem: document.getElementById('problem').value
            };

            fetch(SHEET1_SUBMIT_URL, {
                method: 'POST',
                mode: 'no-cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(() => {
                msgDiv.style.backgroundColor = '#d4edda';
                msgDiv.textContent = 'Success! Task submitted and Telegram message sent.';
                document.getElementById('taskForm').reset();
            })
            .catch(error => {
                msgDiv.style.backgroundColor = '#f8d7da';
                msgDiv.textContent = 'Error: ' + error.message;
            });
        });
    </script>
</body>
</html>